# Feature Specification: ブックマーク集約拡張の初期リリース

**Feature Branch**: `001-aggregate-bookmarks`  
**Created**: 2025-12-08  
**Status**: Draft  
**Input**: User description: "特定のブログサイトやSNSなどのあらゆるブックマークを一元管理する拡張機能を作成する。"

## User Scenarios & Testing *(mandatory)*

<!--
  IMPORTANT: User stories should be PRIORITIZED as user journeys ordered by importance.
  Each user story/journey must be INDEPENDENTLY TESTABLE - meaning if you implement just ONE of them,
  you should still have a viable MVP (Minimum Viable Product) that delivers value.
  
  Assign priorities (P1, P2, P3, etc.) to each story, where P1 is the most critical.
  Think of each story as a standalone slice of functionality that can be:
  - Developed independently
  - Tested independently
  - Deployed independently
  - Demonstrated to users independently
-->

### User Story 1 - 優先サイトのブックマークを一括把握 (Priority: P1)

情報収集が多いユーザーとして、よく確認するブログやSNSドメインを登録しておくと、ブラウザ上で保存した最新のブックマークが拡張機能内に一括表示され、確認漏れを防ぎたい。

**Why this priority**: 集約ビューがなければ「どこを再確認すべきか」が分からず、以降のリマインドや要約も価値を発揮できないため最優先。

**Independent Test**: テスト用のドメインを2つ登録し、ブラウザで複数ブックマークを保存後、拡張機能を開いて登録ドメインのみが最新順で並ぶことを確認する。

**Acceptance Scenarios**:

1. **Given** ユーザーがQiitaとNoteを対象サイトとして登録し、各サイトの記事をブックマークしている, **When** 拡張機能を開く, **Then** 対象サイトによるフィルタ済みリストが最終保存日時順に表示され、サイト名・タイトル・保存日時が確認できる。
2. **Given** 対象サイトに一致するブックマークが現時点で存在しない, **When** 拡張機能を開く, **Then** 空状態メッセージと登録方法ガイドが表示され、誤解を招く空白画面にならない。

---

---

### User Story 2 - Googleアカウントで個別設定 (Priority: P2)

複数デバイスで情報整理を続けたいユーザーとして、Googleアカウントでワンタップサインインし、自分専用の対象サイトやステータス設定を同期できると安心感がある。

**Why this priority**: 認証を早期に提供することで、後工程のリマインド・エクスポート機能を個人アカウントにひも付けて検証できる。

**Independent Test**: テスト用Googleアカウントでログインし、対象サイト設定を行った後に再ログインして設定が復元されるかを確認する。

**Acceptance Scenarios**:

1. **Given** 初回アクセスのユーザー, **When** 「Googleでログイン」を実行し同意を完了する, **Then** 拡張機能にユーザー名・アイコンが表示され、個別設定エリアが解放される。
2. **Given** ユーザーがGoogleログインに失敗した, **When** 再試行するまたはスキップを選択する, **Then** 明確なエラー説明と再試行手順が表示され、ローカルモードでの利用可能性も提示される。

---

### User Story 3 - 未読管理と再確認リマインド (Priority: P3)

忙しいユーザーとして、一覧で個々のブックマークを「確認済み／未確認」に切り替えたり、翌朝の再読リマインダーを付けられることで、後回しにした情報を確実に消化したい。

**Why this priority**: 集約ビューだけでは「読んだかどうか」の状態管理ができず、再読習慣を作れないため次に重要。

**Independent Test**: ブックマークを未確認のままリスト表示し、ユーザー操作で状態変更とリマインダー設定が保存・反映されることを確認する。

**Acceptance Scenarios**:

1. **Given** ユーザーがリスト上のブックマークを「未確認」のまま保持している, **When** 「確認済みにする」をクリックする, **Then** 対象行のステータスが即時更新され、再読み込み後も状態が保持される。
2. **Given** ユーザーが翌朝7時のリマインダーを設定していない, **When** ブックマーク詳細から「翌朝リマインド」を選択する, **Then** リマインダーが登録され、ダイジェストに当該アイテムがハイライトされる。

---

---

### User Story 4 - 朝のダイジェスト確認 (Priority: P4)

朝の情報収集時間に短時間で全体像を把握したいユーザーとして、未確認ブックマークの件数・主要トピック要約・優先度がまとまったダイジェストビューを受け取り、別チャネル（例：LINE）への転送可否を判断したい。

**Why this priority**: 初期段階でダイジェストを用意することで、将来的なLINE通知やニュースレター自動化へ滑らかに接続でき、価値の連続性を検証できるため。

**Independent Test**: テストデータで未確認アイテムを10件用意し、指定時間にダイジェストビューが生成・表示され、要約と件数が期待どおりであることを確認する。

**Acceptance Scenarios**:

1. **Given** ユーザーが未確認ブックマークを複数保持し、ダイジェスト時間を7時に設定している, **When** 指定時間に拡張機能を開く, **Then** 「本日の未確認○件」「優先度高（3件）」などのサマリーと各リンクが表示される。
2. **Given** ユーザーがダイジェストを別チャネルに共有したい, **When** 「共有用要約をコピー」操作を行う, **Then** タイトル・URL・抜粋を含むテキストがクリップボードにコピーされ、手動でLINE送信できる。

---

[Add more user stories as needed, each with an assigned priority]

### Edge Cases

- 対象ドメインを10件以上登録した際、同期スケジュールが衝突してタイムアウトする場合でもリトライし、どのドメインで失敗したかを表示する。
- 同一URLを複数回ブックマークした場合は最新メタデータで統合し、「重複」タグを表示する。
- ブラウザのブックマークAPIから一時的にアクセス拒否があった場合、ユーザーに再接続手順を案内しつつ既存キャッシュを表示する。
- ネットワークオフライン時はローカルキャッシュのみを読み込み、「最後に同期した日時」を明示する。
- Google認証が失敗した場合はエラー理由（認可拒否、通信断等）ごとに再試行・別アカウント選択・スキップの選択肢を提示する。
- 社会的指標（いいね数・ブックマーク数）取得APIがレート制限された場合、直近キャッシュ値を用い、ダイジェスト上に「推定値」と表示する。
- Googleスプレッドシートのエクスポート quota が上限に達した際はユーザーに再試行タイミングを案内し、ローカルCSVダウンロードを代替手段として提示する。

## Requirements *(mandatory)*

<!--
  ACTION REQUIRED: The content in this section represents placeholders.
  Fill them out with the right functional requirements.
-->

### Functional Requirements

- **FR-001**: ユーザーは対象とするブログ・SNSドメインまたは公式ハンドルを拡張機能内で登録・編集・削除できる。
- **FR-002**: システムはブラウザのブックマークデータから対象ドメインに該当する項目のみを抽出し、最低1時間ごとに差分同期する。
- **FR-003**: 抽出したブックマークはタイトル／URL／保存日時／元ドメイン／任意メモを含むカードとして一覧表示される。
- **FR-004**: ユーザーは各ブックマークを「未確認」「確認済み」「リマインド設定中」の3状態で切り替えられ、状態はローカルに永続化される。
- **FR-005**: ユーザーは任意のブックマークに翌朝7時のデフォルトリマインダー、またはカスタム日時を設定・解除できる。
- **FR-006**: システムは同一URLが複数回保存された場合、最新保存日時を保持しながら履歴をマージし、重複タグを付与する。
- **FR-007**: 一覧はドメイン、保存日時、ステータス、キーワードでフィルタリング・並び替えができる。
- **FR-008**: ダイジェストビューでは未確認件数、優先度上位の3件、前日の新規追加数、リマインダー予定がまとめて表示される。
- **FR-009**: ユーザーはダイジェスト内容をボタン1つでクリップボードコピーし、任意のメッセージアプリに貼り付けられる。
- **FR-010**: すべてのブックマークリスト・設定データはユーザーの同意がある場合を除き端末内に保存され、Google連携に必要な最小限の情報のみが外部サービスと共有される旨を明示する。
- **FR-011**: ユーザーはGoogleアカウントによる認証を選択でき、認証後は対象サイト設定・ステータス・リマインダーがアカウント単位で復元される。
- **FR-012**: システムは取得可能な「いいね数」「ブックマーク数」などの社会的反応メトリクスを集計し、合計値が最も高いブックマークをダイジェスト上で優先表示する。
- **FR-013**: リマインダーは1件につき最大5回まで再通知でき、上限到達時はユーザーに完了または再スケジュールを促す。
- **FR-014**: ユーザーは集約したブックマークとステータスをGoogleスプレッドシートへエクスポートでき、シート構造はタイトル／URL／保存日時／ステータス／メモを含む。

### Key Entities

- **SourceRule**: ユーザーが登録した対象サイトやSNSハンドルを表す。属性には名前、ドメイン／ハンドル、表示カラー、同期ステータス、最終同期時刻が含まれる。BookmarkItemと1対多。
- **BookmarkItem**: 抽出済みブックマークの単位。タイトル、URL、保存日時、関連SourceRule、ステータス（未確認／確認済み／リマインド）、ユーザーメモ、重複フラグを持つ。
- **ReviewReminder**: 再確認の意図を表し、対象BookmarkItem、予定日時、通知チャネル（現段階は拡張機能内ダイジェスト表示のみ）、完了フラグを保持する。

## Assumptions

- 初期リリース対象は主要デスクトップブラウザ（Chromium系）で、ブラウザの標準ブックマークAPIにアクセスできる前提。
- Google認証とスプレッドシート連携は公式OAuthフローを通じてユーザー同意を得られる前提で、その他の外部サービス（例：LINE直接送信）は次フェーズで検討する。
- ブックマーク数は1,000件未満を想定し、ローカル保存で十分なパフォーマンスを発揮できる前提。
- 既存のブラウザタグ／フォルダ階層のインポートは初期スコープ外とし、対象ドメイン指定による集約で代替する。

## Success Criteria *(mandatory)*

<!--
  ACTION REQUIRED: Define measurable success criteria.
  These must be technology-agnostic and measurable.
-->

### Measurable Outcomes

- **SC-001**: 対象ドメインを登録してから最新ブックマークが集約一覧に反映されるまでの時間が平均1分以内である。
- **SC-002**: 1日に少なくとも50件の新規ブックマークを追加しても一覧表示とフィルタ操作が2秒以内で完了する。
- **SC-003**: パイロットユーザーの70%以上が1週間以内に「確認済み」へ変更したブックマークを5件以上持つ。
- **SC-004**: 朝のダイジェストを閲覧したユーザーの80%以上が「後で読む予定の情報を把握しやすくなった」と回答する。
- **SC-005**: Googleアカウント連携を試したユーザーのうち90%以上が2分以内にサインインを完了できる。
- **SC-006**: ダイジェストで提示される「優先度高」上位3件のうち、ユーザーテストで80%以上が「確かに優先して読みたい」と評価する。
